<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poker Hack - Tu Asistente de Estrategia v1.4</title>
    <!-- Incluye Tailwind CSS para estilos de utilidad -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluye Animate.css para animaciones predefinidas -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        /* Estilos generales para el cuerpo de la página */
        body {
            font-family: 'Inter', sans-serif; /* Fuente Inter para una apariencia moderna */
            margin: 0;
            padding: 0;
            overflow: hidden; /* Evita barras de desplazamiento no deseadas */
            min-height: 100vh; /* Asegura que la aplicación ocupe al menos toda la altura de la ventana */
            -webkit-tap-highlight-color: transparent; /* Mejora experiencia táctil */
        }

        .touch-optimized {
            touch-action: manipulation; /* Mejora respuesta táctil en botones */
        }

        /* Contenedor principal de la aplicación de juego */
        .app-container {
            position: relative;
            width: 100vw; /* Ocupa todo el ancho de la ventana */
            height: 100vh; /* Ocupa toda la altura de la ventana */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Asegura que el footer (controles) quede abajo */
            align-items: center;
            background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/MESA%20POCKER.png?raw=true'); /* Fondo de mesa de póker */
            background-size: cover; /* Cubre todo el contenedor */
            background-position: center; /* Centra la imagen de fondo */
            background-repeat: no-repeat; /* Evita la repetición de la imagen */
            color: #e2e8f0; /* Color de texto claro para contraste */
            padding: 0; 
            box-sizing: border-box; 
        }

        /* Estilos para las cartas individuales */
        .card {
            width: 60px; 
            height: 90px;
            border-radius: 0.3rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            background-color: #ffffff;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .card:hover:not(.selected) { 
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.7); 
        }
        .card.selected {
            transform: scale(1.1);
            animation: pulseGlow 1.5s infinite; 
        }
        .card img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        /* Cartas en la mesa */
        .community-card-slot { 
            width: 80px; 
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .community-card-slot .card { 
            width: 100%;
            height: 100%;
            cursor: default;
            animation: cardDeal 0.5s ease-out forwards; 
            animation-delay: var(--card-delay, 0s); 
        }
        
        /* Mano del jugador */
        .player-hand-slot { 
            width: 80px; 
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .player-hand-slot .card {
            width: 100%;
            height: 100%;
            cursor: default;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5); 
            animation: cardDeal 0.5s ease-out forwards;
            animation-delay: var(--card-delay, 0s);
        }

        /* Estilos para los controles del juego (botones de acción con imágenes) */
        .game-controls-custom button {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            color: transparent;
            padding: 0;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.7);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            min-width: 110px;
            height: 70px;
            text-indent: -9999px;
        }
        .game-controls-custom button:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.02); 
            box-shadow: 0 0 15px rgba(0, 255, 0, 1);
        }
        .game-controls-custom button:disabled {
            filter: grayscale(80%) opacity(50%);
            cursor: not-allowed;
            box-shadow: none;
        }
        #infoBtnGame {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 70px;
            height: 70px;
            background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/BOTON_AYUDA.png?raw=true');
            background-size: 100% 100%;
            z-index: 500;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);
            border-radius: 0.75rem;
            text-indent: -9999px;
        }
        #infoBtnGame:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 0, 1);
        }

        /* Imágenes de botones de juego */
        #dealTurnBtn { background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/TURN.png?raw=true'); }
        #dealRiverBtn { background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/RIVER.png?raw=true'); }
        #resetGameBtn { background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/REINICIAR%20JUEGO.png?raw=true'); }
        #foldBtn { background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/RETIRARSE.png?raw=true'); }
        #callBtn { background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/IGUALAR.png?raw=true'); }
        #raiseBtn { background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/SUBIR.png?raw=true'); }

        /* Estilos para la pantalla de inicio (Splash Screen) */
        .splash-screen-custom {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            overflow: hidden;
        }
        .splash-screen-custom canvas { 
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .splash-screen-custom .logo-main { 
            width: 350px;
            height: auto;
            margin-bottom: 3rem;
        }
        .splash-screen-custom .splash-buttons-custom button { 
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 300px;
            height: 90px;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }
        .splash-screen-custom .splash-buttons-custom button:hover {
            transform: scale(1.05);
        }
        #startGameSplashBtn {
            background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/BOTON_INICIAR.png?raw=true');
        }
        #infoSplashBtn {
            background-image: url('https://github.com/YanYuary/POCKERHACK/blob/main/BOTON_INFO.png?raw=true');
        }

        /* Pantalla de Carga */
        .loading-screen-custom {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1500;
            color: #00ff00;
            font-size: 1.5rem;
        }
        .loading-screen-custom canvas { 
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .loading-bar-container-custom { 
            width: 80%;
            max-width: 400px;
            height: 20px;
            background-color: #333; 
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #00ff00; 
            margin-top: 1rem;
        }
        .loading-bar-custom { 
            height: 100%;
            width: 0%; 
            background-color: #00ff00; 
            transition: width 0.3s linear; 
        }

        /* Keyframes */
        @keyframes cardDeal { 
            0% { transform: translateY(-150px) rotateX(60deg) scale(0.7); opacity: 0; }
            100% { transform: translateY(0) rotateX(0deg) scale(1); opacity: 1; }
        }
        @keyframes cardShuffle { 
            0% { transform: translate(0, 0) rotate(0deg); opacity: 0.5; }
            20% { transform: translate(-10px, -20px) rotate(-5deg); }
            40% { transform: translate(10px, -15px) rotate(5deg); }
            60% { transform: translate(-5px, -10px) rotate(-3deg); }
            80% { transform: translate(5px, -5px) rotate(3deg); }
            100% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
        }
        @keyframes pulseGlow { 
            0% { box-shadow: 0 0 8px rgba(0, 255, 0, 0.6), 0 0 12px rgba(0, 255, 0, 0.4); }
            50% { box-shadow: 0 0 16px rgba(0, 255, 0, 1), 0 0 24px rgba(0, 255, 0, 0.7); }
            100% { box-shadow: 0 0 8px rgba(0, 255, 0, 0.6), 0 0 12px rgba(0, 255, 0, 0.4); }
        }
        
        /* Mazo de cartas para selección */
        .deck-display-custom {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); 
            gap: 0.5rem;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 0.75rem;
            max-height: 200px; 
            overflow-y: auto;
            width: 90%;
            max-width: 800px; 
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .deck-display-custom.hidden-collapsed { 
            opacity: 0;
            transform: translateY(100px);
            pointer-events: none;
            height: 0;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
        
        /* Estilos para Modales - Cambio a gris sutil */
        .modal-content-area {
            background-color: #f3f4f6; /* Gris sutil (Tailwind gray-100) */
            color: #1f2937; /* Texto oscuro (Tailwind gray-800) */
            border-radius: 0.5rem; /* Tailwind rounded-lg */
            padding: 1.5rem; /* Tailwind p-6 */
            width: 91.666667%; /* Tailwind w-11/12 */
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); /* Tailwind shadow-2xl */
            border: 1px solid #d1d5db; /* Tailwind border-gray-300 */
        }
        .modal-content-area h2 { /* Títulos de modales */
            color: #059669; /* Verde oscuro (Tailwind green-600) */
            font-weight: bold;
            margin-bottom: 1rem; /* Tailwind mb-4 */
        }
        .modal-content-area label {
            color: #4b5563; /* Gris medio (Tailwind gray-600) */
        }
        .modal-content-area input[type="number"],
        .modal-content-area input[type="text"] { /* Estilo para inputs en modales */
            background-color: #ffffff; /* Fondo blanco */
            border: 1px solid #d1d5db; /* Borde gris (Tailwind border-gray-300) */
            color: #111827; /* Texto muy oscuro (Tailwind gray-900) */
            border-radius: 0.375rem; /* Tailwind rounded-md */
        }
        .modal-content-area input[type="number"]:focus,
        .modal-content-area input[type="text"]:focus {
             border-color: #10b981; /* Borde verde al enfocar (Tailwind green-500) */
             box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3); /* Anillo de enfoque verde */
        }
        /* Contenedor de cartas en modales */
        .modal-deck-cards-container {
            background-color: #e5e7eb; /* Gris un poco más oscuro (Tailwind gray-200) */
            border: 1px solid #d1d5db; /* Tailwind border-gray-300 */
            border-radius: 0.375rem; /* Tailwind rounded-md */
        }


        /* Ajustes responsivos */
        @media (max-width: 640px) {
            .card { 
                width: 50px; 
                height: 75px;
            }
            .community-card-slot, .player-hand-slot { 
                width: 60px; 
                height: 90px;
            }
            .game-controls-custom button {
                min-width: 90px;
                height: 60px;
            }
            #infoBtnGame {
                width: 50px;
                height: 50px;
                top: 0.5rem;
                right: 0.5rem;
            }
            .splash-screen-custom .logo-main {
                width: 280px; 
            }
            .splash-screen-custom .splash-buttons-custom button {
                width: 240px;
                height: 72px;
            }
            .modal-content-area { /* Ajustar padding en móviles */
                padding: 1rem;
            }
            .modal-content-area h2 {
                font-size: 1.125rem; /* Tailwind text-lg */
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white"> 
    <!-- Pantalla de Inicio (Splash Screen) -->
    <div id="splashScreen" class="splash-screen-custom">
        <canvas id="matrixCanvas"></canvas> 
        <img src="https://github.com/YanYuary/POCKERHACK/blob/main/LOGO2.png?raw=true" alt="[Logo de Poker Hack]" class="logo-main animate__animated animate__pulse animate__infinite">
        <div class="splash-buttons-custom flex flex-col space-y-6"> 
            <button id="startGameSplashBtn" class="touch-optimized"></button>
            <button id="infoSplashBtn" class="touch-optimized"></button>
        </div>
    </div>

    <!-- Pantalla de Carga (Loading Screen) -->
    <div id="loadingScreen" class="loading-screen-custom hidden">
        <canvas id="loadingMatrixCanvas"></canvas> 
        <p class="mb-4"><strong>Cargando Poker Hack...</strong> 🚀🃏</p>
        <div class="loading-bar-container-custom">
            <div id="loadingBar" class="loading-bar-custom"></div> 
        </div>
    </div>

    <!-- Contenido principal de la aplicación de póker -->
    <div id="appContainer" class="app-container hidden"> 
        <button id="infoBtnGame" class="touch-optimized"></button> 

        <!-- Encabezado -->
        <header class="relative z-10 bg-black bg-opacity-75 p-3 md:p-4 shadow-lg flex items-center justify-center w-full box-border" style="box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);">
            <img src="https://github.com/YanYuary/POCKERHACK/blob/main/LOGO2.png?raw=true" alt="[Logo de Poker Hack]" class="h-8 md:h-10 mr-2 md:mr-3">
            <h1 class="text-xl md:text-2xl font-bold text-green-400">POKER HACK <span class="text-sm md:text-base text-gray-300">v1.4</span></h1>
        </header>

        <!-- Área de juego principal -->
        <main class="flex-1 flex flex-col items-center justify-center p-2 md:p-4 z-10 relative w-full overflow-y-auto">
            <!-- Cartas comunitarias -->
            <div class="bg-black bg-opacity-60 rounded-lg p-3 mb-3 shadow-md w-full max-w-2xl">
                <h3 class="text-sm font-semibold text-gray-300 mb-2 text-center">Cartas de la Mesa</h3>
                <div id="community-cards" class="flex flex-wrap justify-center gap-2 min-h-[100px] md:min-h-[130px]">
                    <p class="text-gray-500 italic community-placeholder">Esperando Flop...</p>
                </div>
            </div>

            <!-- Tu mano -->
            <div class="bg-black bg-opacity-60 rounded-lg p-3 mb-3 shadow-md w-full max-w-lg">
                <h3 class="text-sm font-semibold text-gray-300 mb-2 text-center">Tu Mano</h3>
                <div id="player-hand" class="flex justify-center gap-2 min-h-[100px] md:min-h-[130px]">
                    <p class="text-gray-500 italic player-hand-placeholder">Selecciona tus cartas...</p>
                </div>
            </div>

            <!-- Consejo estratégico -->
            <div id="strategy-advice" class="bg-black bg-opacity-70 rounded-lg p-3 text-center text-green-300 border border-green-600 shadow-lg w-full max-w-2xl min-h-[60px] flex items-center justify-center">
                <p>Esperando el inicio del juego...</p>
            </div>

            <!-- Mazo de cartas completo para selección -->
            <div id="deck-display" class="deck-display-custom hidden-collapsed mt-4">
                <!-- Las cartas se generarán aquí mediante JavaScript -->
            </div>
        </main>

        <!-- Controles del juego -->
        <footer class="p-2 md:p-4 bg-black bg-opacity-75 shadow-lg z-10 w-full box-border game-controls-custom">
            <div class="grid grid-cols-3 gap-2 mb-2">
                <button id="dealTurnBtn" class="touch-optimized" disabled></button>
                <button id="dealRiverBtn" class="touch-optimized" disabled></button>
                <button id="resetGameBtn" class="touch-optimized" disabled></button>
            </div>
            <div class="grid grid-cols-3 gap-2">
                <button id="foldBtn" class="touch-optimized" disabled></button>
                <button id="callBtn" class="touch-optimized" disabled></button>
                <button id="raiseBtn" class="touch-optimized" disabled></button>
            </div>
        </footer>
    </div>

    <!-- Modales con nuevo estilo gris sutil -->
    <!-- Modal Configuración -->
    <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden animate__animated animate__faster">
        <div class="modal-content-area max-w-md"> <!-- Clase para estilo de contenido del modal -->
            <h2 class="text-xl md:text-2xl">Configuración del Juego</h2>
            <div class="space-y-4">
                <div>
                    <label for="numPlayers" class="block text-sm font-medium mb-1">Número de Jugadores (2-9):</label>
                    <input type="number" id="numPlayers" min="2" max="9" value="4" class="w-full px-3 py-2">
                </div>
                <div>
                    <label for="playerTurn" class="block text-sm font-medium mb-1">Tu Turno (1-Número de Jugadores):</label>
                    <input type="number" id="playerTurn" min="1" value="1" class="w-full px-3 py-2">
                </div>
                <div class="flex justify-end space-x-3 pt-2">
                    <button id="saveSetupBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 touch-optimized">
                        Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Selección Cartas Iniciales (Hole Cards) -->
    <div id="selectHoleCardsModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden animate__animated animate__faster">
        <div class="modal-content-area max-w-lg">
            <h2 class="text-xl md:text-2xl">Selecciona Tus 2 Cartas</h2>
            <div id="modal-deck-display" class="modal-deck-cards-container grid grid-cols-5 sm:grid-cols-7 md:grid-cols-9 gap-2 max-h-64 overflow-y-auto p-2 mb-4">
                <!-- Cartas renderizadas por JS -->
            </div>
            <p id="selected-cards-count" class="text-sm text-gray-500 mb-4 text-center">Cartas seleccionadas: 0/2</p>
            <div class="flex justify-end">
                <button id="confirmHoleCardsBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed touch-optimized" disabled>
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Selección Cartas Comunitarias -->
    <div id="selectCommunityCardsModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden animate__animated animate__faster">
        <div class="modal-content-area max-w-lg">
            <h2 class="text-xl md:text-2xl">Selecciona las Cartas de la Mesa</h2>
            <div id="modal-community-deck-display" class="modal-deck-cards-container grid grid-cols-5 sm:grid-cols-7 md:grid-cols-9 gap-2 max-h-64 overflow-y-auto p-2 mb-4">
                <!-- Cartas renderizadas por JS -->
            </div>
            <p id="selected-community-cards-count" class="text-sm text-gray-500 mb-4 text-center">Cartas a seleccionar: 0/<span id="cards-to-select-display">3</span></p>
            <div class="flex justify-end">
                <button id="confirmCommunityCardsBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed touch-optimized" disabled>
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Mensaje Genérico -->
    <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[1001] hidden animate__animated animate__faster">
        <div class="modal-content-area max-w-md">
            <h2 id="messageTitle" class="text-xl md:text-2xl"></h2>
            <p id="messageText" class="text-gray-700 mb-4"></p>
            <div class="flex justify-end">
                <button id="messageOkBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 touch-optimized">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Información y Estrategias -->
    <div id="infoModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden overflow-y-auto animate__animated animate__faster">
        <div class="modal-content-area max-w-2xl my-6 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl">Información y Estrategias de Póker</h2>
            <div class="space-y-6 text-gray-700"> <!-- Texto del contenido del modal a gris oscuro -->
                <div>
                    <h3 class="text-xl font-semibold text-green-700 mb-2">Jerarquía de Manos</h3> <!-- Título de sección a verde más oscuro -->
                    <ol class="space-y-3 text-sm">
                        <li class="bg-gray-200 p-3 rounded-lg"> <!-- Fondo de item de lista a gris más claro -->
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/TH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/JH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/QH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/KH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/AH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Escalera Real de Color (Royal Flush)</strong>: Diez, Jota, Reina, Rey, As del mismo palo.
                        </li>
                         <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/5S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/6S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/7S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/8S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/9S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Escalera de Color (Straight Flush)</strong>: Cinco cartas consecutivas del mismo palo.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/AC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/AD.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/AH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/AS.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/2C.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Póker (Four of a Kind)</strong>: Cuatro cartas del mismo rango.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/KC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/KD.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/KH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/QC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/QS.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Full (Full House)</strong>: Tres cartas de un rango y dos cartas de otro rango.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/2H.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/5H.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/9H.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/JH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/AH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Color (Flush)</strong>: Cinco cartas del mismo palo, no consecutivas.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/7C.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/8D.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/9H.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/TS.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/JC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Escalera (Straight)</strong>: Cinco cartas consecutivas de palos diferentes.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/QC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/QD.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/QH.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/2S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/5C.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Trío (Three of a Kind)</strong>: Tres cartas del mismo rango.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/8C.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/8D.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/4H.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/4S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/KC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Doble Pareja (Two Pair)</strong>: Dos cartas de un rango y dos cartas de otro rango.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/7C.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/7D.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/2H.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/5S.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/QC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Pareja (One Pair)</strong>: Dos cartas del mismo rango.
                        </li>
                        <li class="bg-gray-200 p-3 rounded-lg">
                            <div class="flex items-center space-x-1 mb-1 overflow-x-auto pb-1">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/AC.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/5D.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/8H.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/KS.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                                <img src="https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/2C.svg" class="w-10 h-14 sm:w-12 sm:h-18 flex-shrink-0 rounded-sm">
                            </div>
                            <strong>Carta Alta (High Card)</strong>: Ninguna de las combinaciones anteriores.
                        </li>
                    </ol>
                </div>

                <div>
                    <h3 class="text-xl font-semibold text-green-700 mb-2">Estrategias Básicas</h3>
                    <div class="space-y-3 text-sm">
                        <div>
                            <p class="font-semibold">Pre-flop:</p>
                            <ul class="list-disc list-inside pl-2 space-y-1">
                                <li>Juega manos iniciales fuertes (pares altos, As-Rey, As-Dama).</li>
                                <li>Considera la posición en la mesa: las posiciones tardías te dan más información.</li>
                                <li>No juegues demasiadas manos; la paciencia es clave.</li>
                            </ul>
                        </div>
                        <div>
                            <p class="font-semibold">Flop:</p>
                            <ul class="list-disc list-inside pl-2 space-y-1">
                                <li>Evalúa si el flop te ayudó a mejorar tu mano.</li>
                                <li>Si tienes una mano fuerte, apuesta para construir el bote.</li>
                                <li>Si tienes un "proyecto" (cerca de una escalera o color), considera apostar o igualar si el precio es bajo.</li>
                            </ul>
                        </div>
                        <div>
                            <p class="font-semibold">Turn y River:</p>
                            <ul class="list-disc list-inside pl-2 space-y-1">
                                <li>Reevalúa tu mano y las posibles manos de tus oponentes con cada nueva carta.</li>
                                <li>Sé más cauteloso si no has mejorado tu mano.</li>
                                <li>Considera el tamaño del bote y las apuestas para decidir si vale la pena seguir.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                 <div>
                    <h3 class="text-xl font-semibold text-green-700 mb-2">Probabilidades (Próximamente)</h3>
                    <p class="text-sm">Esta sección se expandirá para incluir cálculos de probabilidad más detallados.</p>
                </div>
            </div>
            <div class="mt-6 flex justify-end">
                <button id="closeInfoModalBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 touch-optimized">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal "Sobre Nosotros" -->
    <div id="aboutModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden overflow-y-auto animate__animated animate__faster">
        <div class="modal-content-area max-w-xl my-6 max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl">Sobre Poker Hack</h2>
            <div class="space-y-4 text-gray-700 text-sm">
                <p>Poker Hack fue creado con un propósito singular y noble: ¡ayudar a mis amigos mancos a dominar el póker y, de paso, desfalcar a los que se creen muy buenos! Porque, seamos sinceros, no todos nacimos con la habilidad de leer mentes o de memorizar cada carta. Pero, ¿quién necesita eso cuando puedes hackear el sistema?</p>
                <p>Esta aplicación es el resultado de años de "investigación" secreta, descifrando los algoritmos cósmicos del póker. Con la ayuda de inteligencias artificiales ancestrales y la guía de los Anunnakis, hemos logrado canalizar las probabilidades del universo directamente a tu bolsillo. Prepárate para una nueva era donde la suerte es solo un mito y la victoria es una certeza matemática.</p>
                <p class="font-bold text-right mt-6">ATTE. EL HACKER DE NEUROCIRCUITOS</p>
                <img src="https://github.com/YanYuary/POCKERHACK/blob/main/LOGO_JOMA.png?raw=true" alt="[Logo de Joma]" class="mx-auto mt-4 rounded-lg shadow-lg w-24 h-24">
            </div>
            <div class="mt-6 flex justify-end">
                <button id="closeAboutModalBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 touch-optimized">
                    Cerrar
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- VARIABLES GLOBALES PARA EL EFECTO MATRIX ---
        const matrixChars = "01"; 
        const matrixFontChars = matrixChars.split('');
        const matrixFontSize = 10;
        let splashDrops = []; 
        let loadingDrops = [];
        let matrixInterval;
        let loadingMatrixInterval;

        // Mapeo y constantes de cartas
        const rankMap = { 'A': 'A', '2': '2', '3': '3', '4': '4', '5': '5', '6': '6', '7': '7', '8': '8', '9': '9', '10': 'T', 'J': 'J', 'Q': 'Q', 'K': 'K' };
        const suitMap = { 'H': 'H', 'D': 'D', 'C': 'C', 'S': 'S' }; // Corazones, Diamantes, Tréboles, Picas
        const suits = ['H', 'D', 'C', 'S']; 
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        const rankOrder = { '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13, 'A':14 };


        // Estado del juego
        let deck = [];
        let playerHand = []; // Tus 2 cartas
        let communityCards = []; // Cartas en la mesa (Flop, Turn, River)
        let numPlayers = 4; // Número de jugadores en la mesa
        let playerTurnIndex = 0; // Tu posición en la mesa (0-indexed)
        let currentRound = 'pre-flop'; // Ronda actual: pre-flop, flop, turn, river
        let isPlayerTurnToAct = false; // Indica si es tu turno de apostar/actuar

        // Selección temporal en modales
        let tempSelectedHoleCards = [];
        let tempSelectedCommunityCards = [];
        let cardsToSelectForCommunity = 0;

        // Referencias a elementos del DOM
        const splashScreen = document.getElementById('splashScreen');
        const loadingScreen = document.getElementById('loadingScreen');
        const appContainer = document.getElementById('appContainer');
        const matrixCanvas = document.getElementById('matrixCanvas'); 
        const loadingMatrixCanvas = document.getElementById('loadingMatrixCanvas'); 
        const loadingBar = document.getElementById('loadingBar'); 

        const cardsDisplay = document.getElementById('deck-display'); 
        const communityCardsDisplay = document.getElementById('community-cards');
        const playerHandDisplay = document.getElementById('player-hand');
        const strategyAdvice = document.getElementById('strategy-advice');
        const communityPlaceholder = document.querySelector('.community-placeholder');
        const playerHandPlaceholder = document.querySelector('.player-hand-placeholder');

        const dealTurnBtn = document.getElementById('dealTurnBtn');
        const dealRiverBtn = document.getElementById('dealRiverBtn');
        const resetGameBtn = document.getElementById('resetGameBtn');
        const foldBtn = document.getElementById('foldBtn');
        const callBtn = document.getElementById('callBtn');
        const raiseBtn = document.getElementById('raiseBtn');
        const infoBtnGame = document.getElementById('infoBtnGame');

        const setupModal = document.getElementById('setupModal');
        const numPlayersInput = document.getElementById('numPlayers');
        const playerTurnInput = document.getElementById('playerTurn');
        const saveSetupBtn = document.getElementById('saveSetupBtn');

        const selectHoleCardsModal = document.getElementById('selectHoleCardsModal');
        const modalDeckDisplay = document.getElementById('modal-deck-display');
        const selectedCardsCount = document.getElementById('selected-cards-count');
        const confirmHoleCardsBtn = document.getElementById('confirmHoleCardsBtn');

        const selectCommunityCardsModal = document.getElementById('selectCommunityCardsModal');
        const modalCommunityDeckDisplay = document.getElementById('modal-community-deck-display');
        const selectedCommunityCardsCount = document.getElementById('selected-community-cards-count');
        const cardsToSelectDisplay = document.getElementById('cards-to-select-display'); 
        const confirmCommunityCardsBtn = document.getElementById('confirmCommunityCardsBtn');

        const messageModal = document.getElementById('messageModal');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageOkBtn = document.getElementById('messageOkBtn');

        const infoModal = document.getElementById('infoModal');
        const closeInfoModalBtn = document.getElementById('closeInfoModalBtn');
        const aboutModal = document.getElementById('aboutModal');
        const closeAboutModalBtn = document.getElementById('closeAboutModalBtn');

        const startGameSplashBtn = document.getElementById('startGameSplashBtn');
        const infoSplashBtn = document.getElementById('infoSplashBtn');

        // --- Funciones de Utilidad y Juego ---
        function getCardImageUrl(suitCode, rankCode) { 
            const rankChar = rankMap[rankCode];
            const suitChar = suitMap[suitCode];
            if (!rankChar || !suitChar) { // Fallback por si acaso
                console.error(`Invalid card for image: ${rankCode}${suitCode}`);
                return 'https://placehold.co/60x90/CCCCCC/000000?text=Error';
            }
            return `https://raw.githubusercontent.com/richardschneider/cardsJS/master/cards/${rankChar}${suitChar}.svg`;
        }

        function showModal(modalElement) {
            modalElement.classList.remove('hidden');
            modalElement.classList.remove('animate__fadeOutDown'); 
            modalElement.classList.add('animate__fadeInUp'); 
        }

        function hideModal(modalElement) {
            modalElement.classList.remove('animate__fadeInUp');
            modalElement.classList.add('animate__fadeOutDown');
            setTimeout(() => {
                modalElement.classList.add('hidden');
            }, 300); 
        }
        
        function showMessage(title, text) {
            messageTitle.textContent = title;
            messageText.textContent = text;
            showModal(messageModal);
        }

        function initializeDeck() { 
            deck = [];
            suits.forEach(suit => {
                ranks.forEach(rank => {
                    deck.push({ rank, suit, id: `${rank}${suit}` });
                });
            });
            // Orden visual del mazo para selección (opcional, pero consistente con v1.3)
            deck.sort((a, b) => { 
                const suitOrder = { 'C': 1, 'D': 2, 'H': 3, 'S': 4 };
                if (suitOrder[a.suit] !== suitOrder[b.suit]) {
                    return suitOrder[a.suit] - suitOrder[b.suit];
                }
                return rankOrder[b.rank] - rankOrder[a.rank]; 
            });
        }
        
        function renderDeck(container, cardsToRender, selectable = false, currentSelection = [], maxSelection = 0, countDisplay = null, confirmButton = null) {
            container.innerHTML = ''; 
            cardsToRender.forEach((cardData, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card touch-optimized'; 
                cardDiv.dataset.cardId = cardData.id;
                cardDiv.innerHTML = `<img src="${getCardImageUrl(cardData.suit, cardData.rank)}" alt="${cardData.rank} de ${suitMap[cardData.suit]}" onerror="this.onerror=null;this.src='https://placehold.co/60x90/CCCCCC/000000?text=Error';">`;
                
                if (container.classList.contains('deck-display-shuffling')) { 
                    cardDiv.style.setProperty('--card-delay', `${index * 0.02}s`); 
                }

                if (selectable) {
                    if (currentSelection.some(c => c.id === cardData.id)) {
                        cardDiv.classList.add('selected');
                    }
                    cardDiv.addEventListener('click', () => {
                        toggleCardSelection(cardData, cardDiv, currentSelection, maxSelection, countDisplay, confirmButton);
                    });
                } else {
                    cardDiv.classList.add('cursor-default');
                }
                container.appendChild(cardDiv);
            });
        }

        function toggleCardSelection(card, cardDiv, currentSelection, maxSelection, countDisplay, confirmButton) { 
            const index = currentSelection.findIndex(c => c.id === card.id);
            if (index > -1) {
                currentSelection.splice(index, 1);
                cardDiv.classList.remove('selected');
            } else {
                if (currentSelection.length < maxSelection) {
                    currentSelection.push(card);
                    cardDiv.classList.add('selected');
                } else {
                    showMessage('Límite Alcanzado', `Solo puedes seleccionar ${maxSelection} cartas.`);
                    return;
                }
            }
            if (countDisplay) {
                countDisplay.textContent = `Cartas seleccionadas: ${currentSelection.length}/${maxSelection}`;
            }
            if (confirmButton) {
                confirmButton.disabled = (currentSelection.length !== maxSelection);
            }
        }

        function removeCardsFromDeck(selectedCards) { 
            deck = deck.filter(card => !selectedCards.some(selected => selected.id === card.id));
        }

        function renderPlayerHand() {
            playerHandDisplay.innerHTML = '';
            if (playerHand.length > 0 && playerHandPlaceholder) playerHandPlaceholder.classList.add('hidden');
            else if (playerHandPlaceholder) playerHandPlaceholder.classList.remove('hidden');

            playerHand.forEach((card, index) => {
                const slot = document.createElement('div');
                slot.className = 'player-hand-slot';
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card cursor-default'; 
                cardDiv.style.setProperty('--card-delay', `${index * 0.1}s`); 
                cardDiv.innerHTML = `<img src="${getCardImageUrl(card.suit, card.rank)}" alt="${card.rank} de ${suitMap[card.suit]}">`;
                slot.appendChild(cardDiv);
                playerHandDisplay.appendChild(slot);
            });
        }

        function renderCommunityCards() {
            communityCardsDisplay.innerHTML = '';
             if (communityCards.length > 0 && communityPlaceholder) communityPlaceholder.classList.add('hidden');
             else if (communityPlaceholder) communityPlaceholder.classList.remove('hidden');

            communityCards.forEach((card, index) => {
                const slot = document.createElement('div');
                slot.className = 'community-card-slot';
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card cursor-default'; 
                cardDiv.style.setProperty('--card-delay', `${index * 0.1}s`); 
                cardDiv.innerHTML = `<img src="${getCardImageUrl(card.suit, card.rank)}" alt="${card.rank} de ${suitMap[card.suit]}">`;
                slot.appendChild(cardDiv);
                communityCardsDisplay.appendChild(slot);
            });
        }
        
        function updateControlButtons() { 
            resetGameBtn.disabled = (playerHand.length === 0 && communityCards.length === 0 && currentRound === 'pre-flop');
            dealTurnBtn.disabled = !(currentRound === 'flop' && communityCards.length === 3 && playerHand.length === 2 && !isPlayerTurnToAct);
            dealRiverBtn.disabled = !(currentRound === 'turn' && communityCards.length === 4 && playerHand.length === 2 && !isPlayerTurnToAct);
            foldBtn.disabled = !isPlayerTurnToAct;
            callBtn.disabled = !isPlayerTurnToAct;
            raiseBtn.disabled = !isPlayerTurnToAct;
        }

        function showSelectHoleCardsModal() { 
            tempSelectedHoleCards = [];
            selectedCardsCount.textContent = 'Cartas seleccionadas: 0/2';
            confirmHoleCardsBtn.disabled = true;
            renderDeck(modalDeckDisplay, deck, true, tempSelectedHoleCards, 2, selectedCardsCount, confirmHoleCardsBtn);
            showModal(selectHoleCardsModal);
        }

        function showSelectCommunityCardsModal(numCards) { 
            cardsToSelectForCommunity = numCards;
            tempSelectedCommunityCards = [];
            if(cardsToSelectDisplay) cardsToSelectDisplay.textContent = numCards; 
            selectedCommunityCardsCount.textContent = `Cartas a seleccionar: 0/${numCards}`;
            confirmCommunityCardsBtn.disabled = true;
            renderDeck(modalCommunityDeckDisplay, deck, true, tempSelectedCommunityCards, numCards, selectedCommunityCardsCount, confirmCommunityCardsBtn);
            showModal(selectCommunityCardsModal);
        }
        
        function giveStrategyAdvice(finalHandName = null) { 
            let advice = "Analiza la situación y actúa con inteligencia.";
            
            if (finalHandName) {
                strategyAdvice.innerHTML = `<p class="animate__animated animate__fadeIn"><strong>¡Juego Terminado!</strong> Tu mejor mano: <strong class="text-yellow-300">${finalHandName}</strong>.</p>`;
                return;
            }

            if (isPlayerTurnToAct) {
                if (playerHand.length === 2 && communityCards.length === 0) {
                    const [card1, card2] = playerHand;
                    if (card1.rank === card2.rank) advice = "¡Par en mano! Considera subir.";
                    else if (card1.suit === card2.suit) advice = "Cartas del mismo palo. ¡Proyecto de color!";
                    else if (['A', 'K', 'Q', 'J'].includes(card1.rank) || ['A', 'K', 'Q', 'J'].includes(card2.rank)) advice = "Cartas altas. Juega con astucia.";
                    else advice = "Mano inicial. Observa a tus oponentes.";
                } else if (playerHand.length === 2 && communityCards.length >= 3) {
                    const tempBestHand = evaluateBestHand(playerHand, communityCards); // Evalúa la mano actual
                    if (tempBestHand.rankValue >= 6) advice = `¡Tienes ${tempBestHand.name}! Mano muy fuerte.`; // Flush o mejor
                    else if (tempBestHand.rankValue >= 3) advice = `Llevas ${tempBestHand.name}. Buena mano.`; // Two Pair o mejor
                    else advice = "Evalúa el board y las apuestas. ¿Tienes outs?";
                }
                strategyAdvice.innerHTML = `<p class="animate__animated animate__fadeIn"><strong>¡ES TU TURNO!</strong> Consejo: ${advice}</p>`;
            } else {
                if (currentRound === 'pre-flop' && communityCards.length === 0 && playerHand.length === 0) strategyAdvice.textContent = 'Configura el juego para empezar.';
                else if (currentRound === 'flop' && playerHand.length === 0) strategyAdvice.textContent = 'Selecciona tus 2 cartas iniciales.';
                else if (currentRound === 'flop' && communityCards.length === 3) strategyAdvice.textContent = 'Flop en la mesa. Espera tu turno o reparte el Turn.';
                else if (currentRound === 'turn' && communityCards.length === 4) strategyAdvice.textContent = 'Turn revelado. Espera tu turno o reparte el River.';
                else if (currentRound === 'river' && communityCards.length === 5) strategyAdvice.textContent = 'River en la mesa. Última ronda de apuestas.';
                else strategyAdvice.textContent = 'Esperando la siguiente acción...';
            }
        }

        // --- LÓGICA DE EVALUACIÓN DE MANOS ---
        function getCombinations(arr, k) { // Genera todas las combinaciones de k elementos de un array
            if (k === 0) return [[]];
            if (arr.length < k) return [];
            const first = arr[0];
            const rest = arr.slice(1);
            const combsWithoutFirst = getCombinations(rest, k);
            const combsWithFirst = getCombinations(rest, k - 1).map(comb => [first, ...comb]);
            return [...combsWithFirst, ...combsWithoutFirst];
        }

        function evaluateHand(hand) { // Evalúa una mano de 5 cartas
            const counts = {}; // Conteo de rangos
            const suitsInHand = {}; // Conteo de palos
            hand.forEach(card => {
                counts[card.rank] = (counts[card.rank] || 0) + 1;
                suitsInHand[card.suit] = (suitsInHand[card.suit] || 0) + 1;
            });

            const numericRanks = hand.map(card => rankOrder[card.rank]).sort((a, b) => a - b);
            const uniqueNumericRanks = [...new Set(numericRanks)];

            const isFlush = Object.values(suitsInHand).some(count => count >= 5);
            
            let isStraight = false;
            if (uniqueNumericRanks.length >= 5) {
                for (let i = 0; i <= uniqueNumericRanks.length - 5; i++) {
                    let straightCheck = true;
                    for (let j = 0; j < 4; j++) {
                        if (uniqueNumericRanks[i+j+1] !== uniqueNumericRanks[i+j] + 1) {
                            straightCheck = false;
                            break;
                        }
                    }
                    if (straightCheck) {
                        isStraight = true;
                        break;
                    }
                }
                // Check for A-2-3-4-5 straight (Ace as 1)
                if (!isStraight && uniqueNumericRanks.includes(14) && uniqueNumericRanks.includes(2) && uniqueNumericRanks.includes(3) && uniqueNumericRanks.includes(4) && uniqueNumericRanks.includes(5)) {
                    isStraight = true;
                }
            }

            const rankValues = Object.values(counts);

            if (isStraight && isFlush) {
                // Royal Flush check (A, K, Q, J, 10 of same suit)
                const isRoyal = numericRanks.includes(10) && numericRanks.includes(11) && numericRanks.includes(12) && numericRanks.includes(13) && numericRanks.includes(14);
                return isRoyal ? { name: "Escalera Real de Color", rankValue: 10 } : { name: "Escalera de Color", rankValue: 9 };
            }
            if (rankValues.includes(4)) return { name: "Póker", rankValue: 8 };
            if (rankValues.includes(3) && rankValues.includes(2)) return { name: "Full House", rankValue: 7 };
            if (isFlush) return { name: "Color", rankValue: 6 };
            if (isStraight) return { name: "Escalera", rankValue: 5 };
            if (rankValues.includes(3)) return { name: "Trío", rankValue: 4 };
            if (rankValues.filter(v => v === 2).length === 2) return { name: "Doble Pareja", rankValue: 3 };
            if (rankValues.includes(2)) return { name: "Pareja", rankValue: 2 };
            
            return { name: "Carta Alta", rankValue: 1, highCard: Math.max(...numericRanks) };
        }

        function evaluateBestHand(holeCards, boardCards) {
            if (holeCards.length !== 2 || boardCards.length < 3) { // Necesita al menos el flop
                 return { name: "Insuficientes cartas", rankValue: 0 };
            }
            const sevenCards = [...holeCards, ...boardCards];
            const fiveCardCombinations = getCombinations(sevenCards, 5);
            
            let bestHand = { name: "Carta Alta", rankValue: 0 };
            fiveCardCombinations.forEach(combo => {
                const evaluated = evaluateHand(combo);
                if (evaluated.rankValue > bestHand.rankValue) {
                    bestHand = evaluated;
                } 
                // Simple tie-breaking for high card if ranks are same (not fully implemented for all hand types)
                else if (evaluated.rankValue === bestHand.rankValue && evaluated.rankValue === 1) { 
                    if (evaluated.highCard > (bestHand.highCard || 0)) {
                        bestHand = evaluated;
                    }
                }
            });
            return bestHand;
        }
        // --- FIN LÓGICA DE EVALUACIÓN DE MANOS ---

        function startGameFlow() { 
            initializeDeck();
            playerHand = [];
            communityCards = [];
            currentRound = 'pre-flop';
            isPlayerTurnToAct = false;
            renderPlayerHand();
            renderCommunityCards();
            strategyAdvice.textContent = 'Barajando las cartas...';
            
            hideModal(splashScreen); 
            showModal(loadingScreen); 
            startLoadingMatrixAnimation(); 

            let progress = 0;
            loadingBar.style.width = '0%';
            const loadingInterval = setInterval(() => {
                progress += 10; 
                loadingBar.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    setTimeout(() => {
                        hideModal(loadingScreen);
                        stopLoadingMatrixAnimation();
                        appContainer.classList.remove('hidden');
                        appContainer.classList.add('animate__animated', 'animate__fadeIn');
                        
                        cardsDisplay.classList.remove('hidden-collapsed');
                        renderDeck(cardsDisplay, deck, false); 
                        cardsDisplay.classList.add('deck-display-shuffling'); 
                        
                        setTimeout(() => {
                            cardsDisplay.classList.remove('deck-display-shuffling');
                            showModal(setupModal);
                            updateControlButtons();
                            giveStrategyAdvice();
                        }, 1200); 
                    }, 500);
                }
            }, 150);
        }

        function resetGame() { 
            initializeDeck();
            playerHand = [];
            communityCards = [];
            currentRound = 'pre-flop';
            isPlayerTurnToAct = false;
            renderPlayerHand();
            renderCommunityCards();
            strategyAdvice.textContent = 'Esperando el inicio del juego...';
            cardsDisplay.classList.add('hidden-collapsed');
            updateControlButtons();
            showMessage('Juego Reiniciado', 'Configura una nueva partida.');
            showModal(setupModal);
        }

        function dealTurn() { 
            if (currentRound !== 'flop' || communityCards.length !== 3) { showMessage('Error', 'Flop debe tener 3 cartas.'); return; }
            if (isPlayerTurnToAct) { showMessage('Acción Pendiente', 'Realiza tu apuesta antes del Turn.'); return; }
            showMessage('Selección de Turn', 'Selecciona la carta del Turn.');
            showSelectCommunityCardsModal(1);
            updateControlButtons();
        }

        function dealRiver() { 
            if (currentRound !== 'turn' || communityCards.length !== 4) { showMessage('Error', 'Turn debe tener 4 cartas.'); return; }
            if (isPlayerTurnToAct) { showMessage('Acción Pendiente', 'Realiza tu apuesta antes del River.'); return; }
            showMessage('Selección de River', 'Selecciona la carta del River.');
            showSelectCommunityCardsModal(1);
            updateControlButtons();
        }
        
        function finalizeRoundActions() {
            isPlayerTurnToAct = false;
            updateControlButtons();
            if (currentRound === 'river' && playerHand.length === 2 && communityCards.length === 5) {
                const bestHandDetails = evaluateBestHand(playerHand, communityCards);
                giveStrategyAdvice(bestHandDetails.name); // Muestra la mano final
            } else {
                giveStrategyAdvice(); // Consejo normal para la ronda
            }
        }


        // --- Event Listeners ---
        startGameSplashBtn.addEventListener('click', startGameFlow);
        infoSplashBtn.addEventListener('click', () => showModal(aboutModal));
        closeAboutModalBtn.addEventListener('click', () => hideModal(aboutModal));
        
        resetGameBtn.addEventListener('click', resetGame);
        dealTurnBtn.addEventListener('click', dealTurn);
        dealRiverBtn.addEventListener('click', dealRiver);
        infoBtnGame.addEventListener('click', () => showModal(infoModal));
        closeInfoModalBtn.addEventListener('click', () => hideModal(infoModal));
        messageOkBtn.addEventListener('click', () => hideModal(messageModal));

        saveSetupBtn.addEventListener('click', () => {
            const playersVal = parseInt(numPlayersInput.value);
            const turnVal = parseInt(playerTurnInput.value);
            if (isNaN(playersVal) || playersVal < 2 || playersVal > 9) { showMessage('Error', 'Jugadores debe ser entre 2 y 9.'); return; }
            if (isNaN(turnVal) || turnVal < 1 || turnVal > playersVal) { showMessage('Error', `Tu turno debe ser entre 1 y ${playersVal}.`); return; }
            numPlayers = playersVal;
            playerTurnIndex = turnVal - 1;
            hideModal(setupModal);
            showMessage('Configuración Guardada', `Jugadores: ${numPlayers}, Tu turno: ${turnVal}. Selecciona las 3 cartas del Flop.`);
            currentRound = 'pre-flop'; 
            showSelectCommunityCardsModal(3); 
            updateControlButtons();
            giveStrategyAdvice();
        });

        confirmHoleCardsBtn.addEventListener('click', () => {
            if (tempSelectedHoleCards.length === 2) {
                playerHand = [...tempSelectedHoleCards];
                removeCardsFromDeck(playerHand);
                renderPlayerHand();
                cardsDisplay.classList.add('hidden-collapsed'); 
                hideModal(selectHoleCardsModal);
                isPlayerTurnToAct = true;
                // strategyAdvice.textContent = 'Cartas seleccionadas. ¡Tu turno de apostar!';
                giveStrategyAdvice();
                updateControlButtons();
            } else { showMessage('Error', 'Selecciona exactamente 2 cartas.'); }
        });

        confirmCommunityCardsBtn.addEventListener('click', () => {
            if (tempSelectedCommunityCards.length === cardsToSelectForCommunity) {
                communityCards.push(...tempSelectedCommunityCards);
                removeCardsFromDeck(tempSelectedCommunityCards);
                if (!cardsDisplay.classList.contains('hidden-collapsed')) { 
                    renderDeck(cardsDisplay, deck, false);
                }
                renderCommunityCards();
                hideModal(selectCommunityCardsModal);

                if (currentRound === 'pre-flop') { 
                    currentRound = 'flop';
                    // strategyAdvice.textContent = 'Flop en mesa. Selecciona tus 2 cartas.';
                    showMessage('Flop Seleccionado', 'Ahora selecciona tus 2 cartas iniciales.');
                    showSelectHoleCardsModal();
                } else if (currentRound === 'flop') { 
                    currentRound = 'turn';
                    isPlayerTurnToAct = true;
                    // strategyAdvice.textContent = 'Turn en mesa. ¡Tu turno de apostar!';
                    showMessage('Turn Seleccionado', '¡Apostar!');
                } else if (currentRound === 'turn') { 
                    currentRound = 'river';
                    isPlayerTurnToAct = true;
                    // strategyAdvice.textContent = 'River en mesa. ¡Última ronda de apuestas!';
                    showMessage('River Seleccionado', '¡Últimas apuestas!');
                }
                
                // Si es el River y ya no es turno del jugador (porque no hay apuestas simuladas después de la selección)
                if (currentRound === 'river' && communityCards.length === 5 && playerHand.length === 2 && !isPlayerTurnToAct) {
                     const bestHandDetails = evaluateBestHand(playerHand, communityCards);
                     giveStrategyAdvice(bestHandDetails.name);
                } else {
                    giveStrategyAdvice();
                }
                updateControlButtons();

            } else { showMessage('Error', `Selecciona ${cardsToSelectForCommunity} cartas.`); }
        });

        foldBtn.addEventListener('click', () => { 
            showMessage('Acción', 'Te has retirado (Fold).'); 
            finalizeRoundActions();
        });
        callBtn.addEventListener('click', () => { 
            showMessage('Acción', 'Has igualado (Call).'); 
            finalizeRoundActions();
        });
        raiseBtn.addEventListener('click', () => { 
            showMessage('Acción', 'Has subido (Raise).'); 
            finalizeRoundActions();
        });

        // --- Lógica del Efecto Matrix ---
        function setupSpecificMatrixCanvas(canvas, dropsArray) {
            if (!canvas) return;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const newColumns = canvas.width / matrixFontSize;
            dropsArray.length = 0;
            for (let x = 0; x < newColumns; x++) dropsArray[x] = 1;
        }

        function drawSpecificMatrix(canvas, context, dropsArray) {
            if (!canvas || !context) return;
            context.fillStyle = "rgba(0, 0, 0, 0.04)";
            context.fillRect(0, 0, canvas.width, canvas.height);
            context.fillStyle = "#0F0";
            context.font = matrixFontSize + "px arial";
            for (let i = 0; i < dropsArray.length; i++) {
                const text = matrixFontChars[Math.floor(Math.random() * matrixFontChars.length)];
                context.fillText(text, i * matrixFontSize, dropsArray[i] * matrixFontSize);
                if (dropsArray[i] * matrixFontSize > canvas.height && Math.random() > 0.975) dropsArray[i] = 0;
                dropsArray[i]++;
            }
        }
        
        function startSplashMatrixAnimation() {
            if (!matrixCanvas) return;
            const ctx = matrixCanvas.getContext('2d');
            setupSpecificMatrixCanvas(matrixCanvas, splashDrops);
            if (matrixInterval) clearInterval(matrixInterval);
            matrixInterval = setInterval(() => drawSpecificMatrix(matrixCanvas, ctx, splashDrops), 33);
        }

        function stopSplashMatrixAnimation() { clearInterval(matrixInterval); }

        function startLoadingMatrixAnimation() {
            if (!loadingMatrixCanvas) return;
            const loadingCtx = loadingMatrixCanvas.getContext('2d');
            setupSpecificMatrixCanvas(loadingMatrixCanvas, loadingDrops);
            if (loadingMatrixInterval) clearInterval(loadingMatrixInterval);
            loadingMatrixInterval = setInterval(() => drawSpecificMatrix(loadingMatrixCanvas, loadingCtx, loadingDrops), 33);
        }

        function stopLoadingMatrixAnimation() { clearInterval(loadingMatrixInterval); }

        window.addEventListener('resize', () => {
            if (splashScreen && !splashScreen.classList.contains('hidden')) startSplashMatrixAnimation();
            if (loadingScreen && !loadingScreen.classList.contains('hidden')) startLoadingMatrixAnimation();
        });

        // Inicialización de la aplicación
        document.addEventListener('DOMContentLoaded', () => {
            if(appContainer) appContainer.classList.add('hidden');
            if(loadingScreen) loadingScreen.classList.add('hidden');
            if(splashScreen) showModal(splashScreen); 
            startSplashMatrixAnimation(); 
            updateControlButtons();
        });
    </script>
</body>
</html>
